<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SmartMath</title>

<style>
body{
  margin:0;
  font-family: Arial, sans-serif;
  display:flex;
  height:100vh;
  background:#f4f6fb;
}

.sidebar{
  width:220px;
  background:#1e3a8a;
  color:white;
  padding:20px;
}

.sidebar h2{
  margin-top:0;
}

.sidebar button{
  width:100%;
  margin:6px 0;
  padding:10px;
  border:none;
  border-radius:6px;
  cursor:pointer;
}

.content{
  flex:1;
  padding:20px;
  overflow:auto;
}

.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.card{
  background:white;
  padding:20px;
  margin-top:15px;
  border-radius:10px;
  box-shadow:0 3px 10px rgba(0,0,0,0.08);
}

input, select{
  padding:8px;
  margin:6px 0;
  width:90%;
  max-width:300px;
}

button{
  background:#1e3a8a;
  color:white;
}

button:hover{
  background:#0f2c6c;
}
</style>
</head>

<body>

<div class="sidebar">
  <h2>SmartMath</h2>
  <button onclick="showHome()">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
  <button onclick="showLibrary()">Ø§Ù„Ù…ÙƒØªØ¨Ø©</button>
  <button onclick="showAdmin()">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
  <button onclick="showSuperAdmin()">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…</button>
  <button onclick="logout()">Ø®Ø±ÙˆØ¬</button>
</div>

<div class="content">
  <div class="topbar">
    <h3 id="pageTitle">Dashboard</h3>
    <select onchange="changeLang(this.value)">
      <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
      <option value="en">English</option>
      <option value="zh">ä¸­æ–‡</option>
      <option value="ur">Ø§Ø±Ø¯Ùˆ</option>
    </select>
  </div>

  <div id="main"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>

// ğŸ”´ Ø¶Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Firebase Ù‡Ù†Ø§ ÙÙ‚Ø·
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_AUTH_DOMAIN",
  projectId: "YOUR_PROJECT_ID",
  appId: "YOUR_APP_ID"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

function showHome(){
  document.getElementById("pageTitle").innerText="Home";
  document.getElementById("main").innerHTML=`
    <div class="card">
      <h3>Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨ÙƒÙ… ÙÙŠ SmartMath</h3>
      <p>Global Education Platform</p>
      <p>Founder: Asmail Suliman Hassan Suliman</p>
    </div>
  `;
}

function showLibrary(){
  document.getElementById("pageTitle").innerText="Library";
  document.getElementById("main").innerHTML=`
    <div class="card">
      <h3>ğŸ“š Ø§Ù„Ù…ÙƒØªØ¨Ø©</h3>
      <input id="bookTitle" placeholder="Ø§Ø³Ù… Ø§Ù„ÙƒØªØ§Ø¨">
      <input id="bookUrl" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ÙƒØªØ§Ø¨">
      <button onclick="addBook()">Ø¥Ø¶Ø§ÙØ©</button>
      <div id="books"></div>
    </div>
  `;
  loadBooks();
}

function addBook(){
  db.collection("books").add({
    title: document.getElementById("bookTitle").value,
    url: document.getElementById("bookUrl").value,
    isPremium:false
  });
}

function loadBooks(){
  db.collection("books").onSnapshot(snapshot=>{
    let html="";
    snapshot.forEach(doc=>{
      html+=`<p><a href="${doc.data().url}" target="_blank">${doc.data().title}</a></p>`;
    });
    document.getElementById("books").innerHTML=html;
  });
}

function showAdmin(){
  let user = auth.currentUser;
  if(!user) return;

  db.collection("users").doc(user.uid).get().then(doc=>{
    if(doc.data().role !== "teacher" && doc.data().role !== "superadmin"){
      alert("ØºÙŠØ± Ù…ØµØ±Ø­");
      return;
    }

    document.getElementById("main").innerHTML=`
      <div class="card">
        <h3>Ø¥Ø¶Ø§ÙØ© Ø§Ø®ØªØ¨Ø§Ø±</h3>
        <input id="examTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±">
        <button onclick="addExam()">Ø¥Ø¶Ø§ÙØ©</button>
      </div>
    `;
  });
}

function addExam(){
  db.collection("exams").add({
    title: document.getElementById("examTitle").value,
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  });
}

function showSuperAdmin(){
  let user = auth.currentUser;
  if(!user) return;

  db.collection("users").doc(user.uid).get().then(doc=>{
    if(doc.data().role !== "superadmin"){
      alert("ØºÙŠØ± Ù…ØµØ±Ø­");
      return;
    }

    document.getElementById("main").innerHTML=`
      <div class="card">
        <h3>ğŸ‘‘ Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…</h3>
        <button onclick="loadUsers()">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</button>
        <button onclick="loadStats()">Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
      </div>
    `;
  });
}

function loadUsers(){
  db.collection("users").get().then(snapshot=>{
    let html="<div class='card'><h3>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†</h3>";
    snapshot.forEach(doc=>{
      html+=`<p>${doc.data().email} - ${doc.data().role}</p>`;
    });
    html+="</div>";
    document.getElementById("main").innerHTML=html;
  });
}

function loadStats(){
  Promise.all([
    db.collection("users").get(),
    db.collection("schools").get()
  ]).then(([u,s])=>{
    document.getElementById("main").innerHTML=`
      <div class="card">
        <h3>ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h3>
        <p>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†: ${u.size}</p>
        <p>Ø§Ù„Ù…Ø¯Ø§Ø±Ø³: ${s.size}</p>
      </div>
    `;
  });
}

function changeLang(lang){
  localStorage.setItem("lang",lang);
}

function logout(){
  auth.signOut();
}

auth.onAuthStateChanged(user=>{
  if(user){
    showHome();
  }
});

showHome();

</script>

</body>
</html>
